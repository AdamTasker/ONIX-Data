name: 'Test Report and Code Coverage'

on:
  workflow_run:
    workflows: ["CI"]
    types: [completed]
  
jobs:
  report:
    name: Reports
    runs-on: ubuntu-latest
    steps:
    - name: Clone the repository
      uses: actions/checkout@v2
    - name: .NET Tests Results
      uses: dorny/test-reporter@v1
      with:
        artifact: test-results
        name: .NET Tests results           
        path: '**/**/*.trx'    
        reporter: dotnet-trx
    - name: Download code coverage from GitHub
      uses: dawidd6/action-download-artifact@v2
      with:
        github_token: ${{secrets.GITHUB_TOKEN}}
        workflow: ci.yml
        workflow_conclusion: completed
        name: code-coverage-report
        path: coverage    
    - name: Code Coverage
      uses: zgosalvez/github-actions-report-lcov@v1
      with:
        artifact-name: code-coverage-processed-report
        coverage-files: '**/TestResults/coverage.info'
        minimum-coverage: 0
        github-token: ${{ secrets.GITHUB_TOKEN }}
